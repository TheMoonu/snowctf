<div class="card border-0 rounded-6 px-3 mb-2 mb-md-3">
    <div class="card-body px-2 py-3">
        {% if competition %}
            {% if competition_status == 'upcoming' %}
                <div class="comp-countdown-flex">
                    <span class="comp-status-badge">
                        <i class="fa fa-clock-o"></i> 即将开始
                    </span>
                    <div class="comp-timer-wrapper" data-start-time="{{ competition.start_time|date:'Y/m/d H:i:s' }}" title="距离比赛开始还有" data-toggle="tooltip" data-placement="top">
                        <span class="comp-time-group"><span class="comp-time-block days">02</span>天</span>
                        <span class="comp-time-group"><span class="comp-time-block hours">03</span>时</span>
                        <span class="comp-time-group"><span class="comp-time-block minutes">10</span>分</span>
                        <span class="comp-time-group"><span class="comp-time-block seconds">44</span>秒</span>
                    </div>
                </div>
            {% elif competition_status == 'ongoing' %}
                <div class="comp-countdown-flex">
                    <span class="comp-status-badge comp-status-ongoing">
                        <i class="fa fa-play-circle"></i> 进行中
                    </span>
                    <div class="comp-timer-wrapper" data-end-time="{{ competition.end_time|date:'Y/m/d H:i:s' }}" title="距离比赛结束还有" data-toggle="tooltip" data-placement="top">
                        <span class="comp-time-group"><span class="comp-time-block days">02</span>天</span>
                        <span class="comp-time-group"><span class="comp-time-block hours">03</span>时</span>
                        <span class="comp-time-group"><span class="comp-time-block minutes">10</span>分</span>
                        <span class="comp-time-group"><span class="comp-time-block seconds">44</span>秒</span>
                    </div>
                </div>
            {% else %}
                <div class="comp-countdown-flex">
                    <span class="comp-status-badge comp-status-ended">
                        <i class="fa fa-check-circle"></i> 比赛已结束
                    </span>
                </div>
            {% endif %}
        {% else %}
            <div class="text-center text-muted py-2">
                暂无比赛信息
            </div>
        {% endif %}
    </div>
</div>

<style>
/* 比赛倒计时 */
.comp-countdown-flex {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    width: 100%;
}

.comp-status-badge {
    background-color: #e6efff;
    color: #4775FF;
    font-size: 13px;
    font-weight: 500;
    padding: 5px 12px;
    border-radius: 20px;
    white-space: nowrap;
}

.comp-status-ongoing {
    background-color: #e3fcef;
    color: #10b981;
}

.comp-status-ended {
    background-color: #e6efff;
    color: #4775FF;
}

.comp-timer-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: default;
}

.comp-time-group {
    font-size: 13px;
    color: #666;
    
    white-space: nowrap;
}

.comp-time-block {
    display: inline-block;
    background-color: #e6f0ff;
    color: #333;
    min-width: 32px;
    height: 32px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    line-height: 32px;
    margin-right: 2px;
}

@media (max-width: 400px) {
    .comp-countdown-flex {
        flex-direction: column;
        gap: 8px;
    }
    
    .comp-timer-wrapper {
        justify-content: center;
    }
}
/* 结束 */

</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 初始化Bootstrap工具提示
    $('[data-toggle="tooltip"]').tooltip();
    
    function updateCountdown(timerElement) {
        const startTime = timerElement.dataset.startTime;
        const endTime = timerElement.dataset.endTime;
        const targetTime = startTime || endTime;
        
        if (!targetTime) return;

        function update() {
            const now = new Date().getTime();
            const target = new Date(targetTime).getTime();
            const distance = target - now;

            if (distance < 0) {
                location.reload();
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            timerElement.querySelector('.days').textContent = String(days).padStart(2, '0');
            timerElement.querySelector('.hours').textContent = String(hours).padStart(2, '0');
            timerElement.querySelector('.minutes').textContent = String(minutes).padStart(2, '0');
            timerElement.querySelector('.seconds').textContent = String(seconds).padStart(2, '0');
        }

        update();
        return setInterval(update, 1000);
    }

    document.querySelectorAll('.comp-timer-wrapper').forEach(timer => {
        updateCountdown(timer);
    });
});
</script>